apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-services-dashboard
  namespace: bookstore
  labels:
    grafana_dashboard_json: "1"
data:
  services-dashboard.json: |
    {
      "annotations":{
        "list":[
          {
            "builtIn":1,
            "datasource":"-- Grafana --",
            "enable":true,
            "hide":true,
            "iconColor":"rgba(0, 211, 255, 1)",
            "name":"Annotations & Alerts",
            "type":"dashboard"
          }
        ]
      },
      "description":"All the service metrics Dashboard",
      "editable":true,
      "gnetId":10280,
      "graphTooltip":0,
      "id":1,
      "iteration":1570519112090,
      "links":[

      ],
      "panels":[
        {
          "collapsed":false,
          "gridPos":{
            "h":1,
            "w":24,
            "x":0,
            "y":0
          },
          "id":54,
          "panels":[

          ],
          "title":"Basic Statistics",
          "type":"row"
        },
        {
          "cacheTimeout":null,
          "colorBackground":false,
          "colorValue":true,
          "colors":[
            "rgba(245, 54, 54, 0.9)",
            "#5195ce",
            "rgba(50, 172, 45, 0.97)"
          ],
          "datasource":"Prometheus",
          "decimals":1,
          "editable":true,
          "error":false,
          "format":"s",
          "gauge":{
            "maxValue":100,
            "minValue":0,
            "show":false,
            "thresholdLabels":false,
            "thresholdMarkers":true
          },
          "gridPos":{
            "h":3,
            "w":6,
            "x":0,
            "y":1
          },
          "height":"",
          "id":52,
          "interval":null,
          "links":[

          ],
          "mappingType":1,
          "mappingTypes":[
            {
              "name":"value to text",
              "value":1
            },
            {
              "name":"range to text",
              "value":2
            }
          ],
          "maxDataPoints":100,
          "nullPointMode":"connected",
          "nullText":null,
          "options":{

          },
          "postfix":"",
          "postfixFontSize":"50%",
          "prefix":"",
          "prefixFontSize":"70%",
          "rangeMaps":[
            {
              "from":"null",
              "text":"N/A",
              "to":"null"
            }
          ],
          "sparkline":{
            "fillColor":"rgba(31, 118, 189, 0.18)",
            "full":false,
            "lineColor":"rgb(31, 120, 193)",
            "show":false
          },
          "tableColumn":"",
          "targets":[
            {
              "expr":"process_uptime_seconds{application=\"$application\", instance=\"$instance\"}",
              "format":"time_series",
              "intervalFactor":2,
              "legendFormat":"",
              "metric":"",
              "refId":"A",
              "step":14400
            }
          ],
          "thresholds":"",
          "title":"Uptime",
          "type":"singlestat",
          "valueFontSize":"80%",
          "valueMaps":[
            {
              "op":"=",
              "text":"N/A",
              "value":"null"
            }
          ],
          "valueName":"current"
        },
        {
          "cacheTimeout":null,
          "colorBackground":false,
          "colorValue":true,
          "colors":[
            "rgba(50, 172, 45, 0.97)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(245, 54, 54, 0.9)"
          ],
          "datasource":"Prometheus",
          "decimals":1,
          "editable":true,
          "error":false,
          "format":"percent",
          "gauge":{
            "maxValue":100,
            "minValue":0,
            "show":true,
            "thresholdLabels":false,
            "thresholdMarkers":true
          },
          "gridPos":{
            "h":6,
            "w":5,
            "x":6,
            "y":1
          },
          "id":58,
          "interval":null,
          "links":[

          ],
          "mappingType":1,
          "mappingTypes":[
            {
              "name":"value to text",
              "value":1
            },
            {
              "name":"range to text",
              "value":2
            }
          ],
          "maxDataPoints":100,
          "nullPointMode":"connected",
          "nullText":null,
          "options":{

          },
          "postfix":"",
          "postfixFontSize":"50%",
          "prefix":"",
          "prefixFontSize":"70%",
          "rangeMaps":[
            {
              "from":"null",
              "text":"N/A",
              "to":"null"
            }
          ],
          "sparkline":{
            "fillColor":"rgba(31, 118, 189, 0.18)",
            "full":false,
            "lineColor":"rgb(31, 120, 193)",
            "show":false
          },
          "tableColumn":"",
          "targets":[
            {
              "expr":"sum(jvm_memory_used_bytes{application=\"$application\", instance=\"$instance\", area=\"heap\"})*100/sum(jvm_memory_max_bytes{application=\"$application\",instance=\"$instance\", area=\"heap\"})",
              "format":"time_series",
              "intervalFactor":1,
              "legendFormat":"",
              "refId":"A",
              "step":14400
            }
          ],
          "thresholds":"70,90",
          "title":"Heap Used",
          "type":"singlestat",
          "valueFontSize":"70%",
          "valueMaps":[
            {
              "op":"=",
              "text":"N/A",
              "value":"null"
            }
          ],
          "valueName":"current"
        },
        {
          "cacheTimeout":null,
          "colorBackground":false,
          "colorValue":true,
          "colors":[
            "rgba(50, 172, 45, 0.97)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(245, 54, 54, 0.9)"
          ],
          "datasource":"Prometheus",
          "decimals":1,
          "editable":true,
          "error":false,
          "format":"percent",
          "gauge":{
            "maxValue":100,
            "minValue":0,
            "show":true,
            "thresholdLabels":false,
            "thresholdMarkers":true
          },
          "gridPos":{
            "h":6,
            "w":5,
            "x":11,
            "y":1
          },
          "id":60,
          "interval":null
        }
      ]
    } 